import{D as z,a as F}from"./data-table.constants-C9jLg9DU.js";import{q as S,d as j,b as f,r as n,o as N,c as B,w as a,z as G,a as e,f as L,u as g,B as W,k as H,l as M,m as R,g as J,t as K}from"./index-BFgRTA9O.js";import{r as T,d as Q,a as q}from"./ruleUtils-B_kFGKyT.js";const X=async m=>{try{let r=localStorage.getItem("token");return(await S(r).post("/workers/items",m)).data}catch(r){return console.error(r),z}},Y=async m=>{try{let r=localStorage.getItem("token");return await S(r).post("/workers",m),!0}catch(r){return console.error(r),!1}},Z=async m=>{try{let r=localStorage.getItem("token");return await S(r).put(`/workers/${m.id}`,m),!0}catch(r){return console.error(r),!1}},h=async()=>{try{let m=localStorage.getItem("token");return(await S(m).get("/selects/offices")).data}catch(m){return console.error(m),[]}},A={id:null,name:"",code:null,type:"001",office_id:null,paternal_surname:"",maternal_surname:"",document_type:"001",document_number:"",birthdate:"",phone_number:"",email:"",gender:"",status:!0},E=j({__name:"Form",props:{formState:{type:Object,default:()=>({})},offices:{type:Array,default:()=>[]}},emits:["onSuccess"],setup(m,{emit:r}){const _=r,U=m,c=f(!1),i=[{title:"Administrativo",value:"001"},{title:"Cas",value:"002"},{title:"Obrero",value:"003"},{title:"Profecional de Obra",value:"004"}],b=f(null),t=f({...A,...U.formState}),v=async V=>{var l;const{valid:o}=await((l=b.value)==null?void 0:l.validate());o&&(c.value=!0,t.value.id?await Z(t.value)&&(t.value={...A},_("onSuccess"),V.value=!1):await Y(t.value)&&(t.value={...A},_("onSuccess"),V.value=!1),c.value=!1)};return(V,o)=>{const l=n("v-text-field"),d=n("v-col"),D=n("v-select"),y=n("v-combobox"),w=n("v-switch"),O=n("v-row"),P=n("v-card-item"),k=n("v-btn"),$=n("v-spacer"),C=n("v-card-actions"),x=n("v-card"),I=n("v-form"),s=n("v-dialog");return N(),B(s,{"max-width":"700"},{activator:a(({props:p})=>[G(V.$slots,"btn",{activator:p})]),default:a(({isActive:p})=>[e(I,{onSubmit:L(u=>v(p),["prevent"]),ref_key:"formRef",ref:b},{default:a(()=>[e(x,{title:t.value.id?"Editar":"Crear"},{default:a(()=>[e(P,null,{default:a(()=>[e(O,null,{default:a(()=>[e(d,{cols:"12",md:"6"},{default:a(()=>[e(l,{modelValue:t.value.document_number,"onUpdate:modelValue":o[0]||(o[0]=u=>t.value.document_number=u),label:"DNI",rules:[g(T),g(Q)]},null,8,["modelValue","rules"])]),_:1}),e(d,{cols:"12",md:"6"},{default:a(()=>[e(l,{modelValue:t.value.code,"onUpdate:modelValue":o[1]||(o[1]=u=>t.value.code=u),label:"Código Trabajador"},null,8,["modelValue"])]),_:1}),e(d,{cols:"12"},{default:a(()=>[e(l,{modelValue:t.value.name,"onUpdate:modelValue":o[2]||(o[2]=u=>t.value.name=u),label:"Nombre",rules:[g(T)]},null,8,["modelValue","rules"])]),_:1}),e(d,{cols:"12",md:"6"},{default:a(()=>[e(l,{modelValue:t.value.paternal_surname,"onUpdate:modelValue":o[3]||(o[3]=u=>t.value.paternal_surname=u),label:"Apellido Paterno",rules:[g(q)(t.value.maternal_surname)]},null,8,["modelValue","rules"])]),_:1}),e(d,{cols:"12",md:"6"},{default:a(()=>[e(l,{modelValue:t.value.maternal_surname,"onUpdate:modelValue":o[4]||(o[4]=u=>t.value.maternal_surname=u),label:"Apellido Materno",rules:[g(q)(t.value.paternal_surname)]},null,8,["modelValue","rules"])]),_:1}),e(d,{cols:"12",md:"6"},{default:a(()=>[e(D,{modelValue:t.value.type,"onUpdate:modelValue":o[5]||(o[5]=u=>t.value.type=u),items:i,label:"Tipo de Trabajador",rules:[g(T)]},null,8,["modelValue","rules"])]),_:1}),e(d,{cols:"12",md:"6"},{default:a(()=>[e(y,{modelValue:t.value.office_id,"onUpdate:modelValue":o[6]||(o[6]=u=>t.value.office_id=u),items:[{value:null,title:"Todas las oficinas (no seleccionar ninguna)"},...m.offices],label:"Oficina","return-object":!1},null,8,["modelValue","items"])]),_:1}),e(d,{cols:"12"},{default:a(()=>[e(w,{label:t.value.status?"Activo":"Inactivo",modelValue:t.value.status,"onUpdate:modelValue":o[7]||(o[7]=u=>t.value.status=u),color:"blue-darken-4",inset:""},null,8,["label","modelValue"])]),_:1})]),_:1})]),_:1}),e(C,null,{default:a(()=>[e(k,{text:"Cancel",onClick:u=>p.value=!1},null,8,["onClick"]),e($),e(k,{text:"Guardar",color:"primary",type:"submit",loading:c.value},null,8,["loading"])]),_:2},1024)]),_:2},1032,["title"])]),_:2},1032,["onSubmit"])]),_:3})}}}),ee=j({__name:"DataTable",setup(m){const r=[{title:"Nombre",sortable:!0,value:"name"},{title:"Apellido Paterno",sortable:!0,value:"paternal_surname"},{title:"Apellido Materno",sortable:!0,value:"maternal_surname"},{title:"Tipo",sortable:!0,value:"type_name"},{title:"Estado",sortable:!0,value:"status"},{title:"",value:"actions"}],_=[{title:"Activo",value:!0},{title:"Inactivo",value:!1}],U=[{title:"Administrativo",value:"001"},{title:"Cas",value:"002"},{title:"Obrero",value:"003"},{title:"Profecional de Obra",value:"004"}],c=f(!1),i=f({...F}),b=f([]),t=f({...z}),v=async o=>{c.value=!0,o.value={...o.value,...o},t.value=await X(o.value),c.value=!1};return W(async()=>{b.value=await h()}),(o,l)=>{const d=n("v-btn"),D=n("v-text-field"),y=n("v-col"),w=n("v-select"),O=n("v-row"),P=n("v-card-item"),k=n("v-chip"),$=n("v-data-table-server"),C=n("v-card"),x=H("permission");return N(),B(C,null,{default:a(()=>{var I;return[e(P,null,{default:a(()=>[e(O,{justify:"space-between"},{default:a(()=>[e(y,{cols:"12",md:"5",class:"d-flex justify-end align-end"},{default:a(()=>[e(E,{onOnSuccess:l[0]||(l[0]=s=>v(i.value)),offices:b.value},{btn:a(({activator:s})=>[M(e(d,R(s,{color:"primary",icon:"mdi-plus-circle-outline",class:"me-2"}),null,16),[[x,["workers.create"]]])]),_:1},8,["offices"]),e(D,{modelValue:i.value.search,"onUpdate:modelValue":l[1]||(l[1]=s=>i.value.search=s),label:"Buscar"},null,8,["modelValue"])]),_:1}),e(y,{cols:"12",md:"5",class:"d-flex justify-end align-end"},{default:a(()=>[e(w,{modelValue:i.value.filters.type,"onUpdate:modelValue":[l[2]||(l[2]=s=>i.value.filters.type=s),l[3]||(l[3]=s=>v(i.value))],label:"Tipo",items:U,clearable:"",class:"me-2"},null,8,["modelValue"]),e(w,{modelValue:i.value.filters.status,"onUpdate:modelValue":[l[4]||(l[4]=s=>i.value.filters.status=s),l[5]||(l[5]=s=>v(i.value))],label:"Estado",items:_,clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e($,{"items-per-page":i.value.itemsPerPage,"onUpdate:itemsPerPage":l[7]||(l[7]=s=>i.value.itemsPerPage=s),headers:r,items:(I=t.value)==null?void 0:I.data,"items-length":t.value.total,search:i.value.search,"multi-sort":"",loading:c.value,"item-value":"id","items-per-page-text":"Número de filas por página:","onUpdate:options":l[8]||(l[8]=s=>v(i.value))},{"item.status":a(({item:s})=>[e(k,{color:s.status?"info":"error"},{default:a(()=>[J(K(s.status?"Activo":"Inactivo"),1)]),_:2},1032,["color"])]),"item.actions":a(({item:s})=>[e(E,{"form-state":s,onOnSuccess:l[6]||(l[6]=p=>v(i.value)),offices:b.value},{btn:a(({activator:p})=>[M(e(d,R(p,{density:"comfortable",icon:"mdi-pencil",class:"text-button",variant:"tonal"}),null,16),[[x,["workers.update"]]])]),_:2},1032,["form-state","offices"])]),_:1},8,["items-per-page","items","items-length","search","loading"])]}),_:1})}}}),oe=j({__name:"index",setup(m){return(r,_)=>(N(),B(ee))}});export{oe as default};
