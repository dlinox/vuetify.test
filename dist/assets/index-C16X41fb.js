import{D as U}from"./data-table.constants-C9jLg9DU.js";import{C as O,q as V,d as I,b as v,r as t,o as $,c as B,w as n,z as R,a as e,f as q,u as z,B as M,k as T,l as D,m as N,h as E}from"./index-Blmc5BWJ.js";import{r as F}from"./ruleUtils-B_kFGKyT.js";const G=async l=>{var a,c;try{let o=localStorage.getItem("token"),d=await O.post("http://localhost:8000/api/roles/items",l,{headers:{Authorization:`Bearer ${o}`}});for(let i of d.data.data)i.permissions=(a=i.permissions)==null?void 0:a.split(","),i.permissions=(c=i.permissions)==null?void 0:c.map(s=>parseInt(s));return d.data}catch(o){return console.error(o),U}},A=async()=>{try{let l=localStorage.getItem("token");return(await V(l).get("/roles/permissions")).data}catch(l){return console.error(l),[]}},H=async l=>{try{let a=localStorage.getItem("token");return await V(a).post("/roles",l),!0}catch(a){return console.error(a),!1}},J=async l=>{try{let a=localStorage.getItem("token");return await V(a).put(`/roles/${l.id}`,l),!0}catch(a){return console.error(a),!1}},j=I({__name:"Form",props:{formState:{type:Object,default:()=>({})},permissions:{type:Array,default:()=>[]}},emits:["onSuccess"],setup(l,{emit:a}){const c=a,o=v(!1),d=l,i=v(null),s=v({id:null,name:"",permissions:[],...d.formState}),C=async u=>{var p;const{valid:r}=await((p=i.value)==null?void 0:p.validate());r&&(o.value=!0,s.value.id?await J(s.value)&&(s.value={id:null,name:"",permissions:[]},c("onSuccess"),u.value=!1):await H(s.value)&&(s.value={id:null,name:"",permissions:[]},c("onSuccess"),u.value=!1),o.value=!1)};return(u,r)=>{const p=t("v-text-field"),f=t("v-col"),h=t("v-select"),k=t("v-row"),S=t("v-card-item"),g=t("v-btn"),P=t("v-spacer"),b=t("v-card-actions"),y=t("v-card"),m=t("v-form"),w=t("v-dialog");return $(),B(w,{"max-width":"500"},{activator:n(({props:x})=>[R(u.$slots,"btn",{activator:x})]),default:n(({isActive:x})=>[e(m,{onSubmit:q(_=>C(x),["prevent"]),ref_key:"formRef",ref:i},{default:n(()=>[e(y,{title:s.value.id?"Editar":"Crear"},{default:n(()=>[e(S,null,{default:n(()=>[e(k,null,{default:n(()=>[e(f,{cols:"12"},{default:n(()=>[e(p,{modelValue:s.value.name,"onUpdate:modelValue":r[0]||(r[0]=_=>s.value.name=_),label:"Nombre del rol",rules:[z(F)]},null,8,["modelValue","rules"])]),_:1}),e(f,{cols:"12"},{default:n(()=>[e(h,{modelValue:s.value.permissions,"onUpdate:modelValue":r[1]||(r[1]=_=>s.value.permissions=_),items:l.permissions,label:"Permisos",chips:"",multiple:""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),e(b,null,{default:n(()=>[e(g,{text:"Cancel",onClick:_=>x.value=!1},null,8,["onClick"]),e(P),e(g,{text:"Guardar",color:"primary",type:"submit",loading:o.value},null,8,["loading"])]),_:2},1024)]),_:2},1032,["title"])]),_:2},1032,["onSubmit"])]),_:3})}}}),K={class:"d-flex justify-end"},L=I({__name:"DataTable",setup(l){const a=[{title:"Nombre",sortable:!0,value:"name"},{title:"",value:"actions"}],c=v(!1),o=v({page:1,itemsPerPage:10,search:"",filters:{},sortBy:[],groupBy:""}),d=v([]),i=v({...U}),s=async u=>{c.value=!0,u.value={...u.value,...u},i.value=await G(u.value),c.value=!1};return M(async()=>{await s(o.value),d.value=await A()}),(u,r)=>{const p=t("v-btn"),f=t("v-text-field"),h=t("v-col"),k=t("v-row"),S=t("v-card-item"),g=t("v-data-table-server"),P=t("v-card"),b=T("permission");return $(),B(P,null,{default:n(()=>{var y;return[e(S,null,{default:n(()=>[e(k,{justify:"space-between"},{default:n(()=>[e(h,{cols:"12",md:"5",class:"d-flex justify-end align-end"},{default:n(()=>[e(j,{onOnSuccess:r[0]||(r[0]=m=>s(o.value)),permissions:d.value},{btn:n(({activator:m})=>[D(e(p,N(m,{color:"primary",icon:"mdi-plus-circle-outline",class:"me-2"}),null,16),[[b,["roles.create"]]])]),_:1},8,["permissions"]),e(f,{modelValue:o.value.search,"onUpdate:modelValue":r[1]||(r[1]=m=>o.value.search=m),label:"Buscar"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(g,{"items-per-page":o.value.itemsPerPage,"onUpdate:itemsPerPage":r[3]||(r[3]=m=>o.value.itemsPerPage=m),headers:a,items:(y=i.value)==null?void 0:y.data,"items-length":i.value.total,search:o.value.search,"multi-sort":"",loading:c.value,"item-value":"id","items-per-page-text":"Número de filas por página:"},{"item.actions":n(({item:m})=>[E("div",K,[e(j,{"form-state":m,onOnSuccess:r[2]||(r[2]=w=>s(o.value)),permissions:d.value},{btn:n(({activator:w})=>[D(e(p,N(w,{density:"comfortable",icon:"mdi-pencil",class:"text-button",variant:"tonal"}),null,16),[[b,["roles.update"]]])]),_:2},1032,["form-state","permissions"])])]),_:1},8,["items-per-page","items","items-length","search","loading"])]}),_:1})}}}),Y=I({__name:"index",setup(l){return(a,c)=>($(),B(L))}});export{Y as default};
