import{a as z,D as F}from"./data-table.constants-B0R7xaSt.js";import{q as g,d as A,b as v,r as s,o as N,c as R,w as a,A as G,a as e,f as L,u as d,z as H,k as E,l as T,m as j,g as J,t as K}from"./index-WbBHlAeq.js";import{r as S,d as Q,a as q,e as W}from"./ruleUtils-B_kFGKyT.js";const X=async r=>{try{let u=localStorage.getItem("token");return(await g(u).post("/users/items",r)).data}catch(u){return console.error(u),z}},Y=async r=>{try{let u=localStorage.getItem("token");return await g(u).post("/users",r),!0}catch(u){return console.error(u),!1}},Z=async r=>{try{let u=localStorage.getItem("token");return await g(u).put(`/users/${r.id}`,r),!0}catch(u){return console.error(u),!1}},h=async()=>{try{let r=localStorage.getItem("token");return(await g(r).get("/selects/offices")).data}catch(r){return console.error(r),[]}},ee=async()=>{try{let r=localStorage.getItem("token");return(await g(r).get("/selects/roles")).data}catch(r){return console.error(r),[]}},te={id:null,name:"",paternal_surname:"",maternal_surname:"",document_type:"001",document_number:"",office_id:null,role_id:null,email:"",password:"",status:!0,is_editable:!1},B=A({__name:"Form",props:{formState:{type:Object},offices:{type:Array,default:()=>[]},roles:{type:Array,default:()=>[]}},emits:["onSuccess"],setup(r,{emit:u}){const c=u,p=v(!1),k=r,_=v(null),t=v({...te,...k.formState}),b=async m=>{const{valid:n}=await _.value.validate();n&&(p.value=!0,t.value.id?await Z(t.value)&&(c("onSuccess"),m.value=!1):await Y(t.value)&&(c("onSuccess"),m.value=!1),p.value=!1)};return(m,n)=>{const i=s("v-text-field"),o=s("v-col"),V=s("v-combobox"),U=s("v-select"),y=s("v-switch"),D=s("v-row"),C=s("v-card-item"),w=s("v-btn"),M=s("v-spacer"),P=s("v-card-actions"),$=s("v-card"),x=s("v-form"),I=s("v-dialog");return N(),R(I,{"max-width":"700"},{activator:a(({props:f})=>[G(m.$slots,"btn",{activator:f})]),default:a(({isActive:f})=>[e(x,{ref_key:"formRef",ref:_,onSubmit:L(l=>b(f),["prevent"])},{default:a(()=>[e($,{title:t.value.id?"Editar":"Crear"},{default:a(()=>[e(C,null,{default:a(()=>[e(D,null,{default:a(()=>[e(o,{cols:"12",md:"4"},{default:a(()=>[e(i,{modelValue:t.value.document_number,"onUpdate:modelValue":n[0]||(n[0]=l=>t.value.document_number=l),modelModifiers:{trim:!0},label:"DNI",rules:[d(S),d(Q)]},null,8,["modelValue","rules"])]),_:1}),e(o,{cols:"12",md:"8"},{default:a(()=>[e(i,{modelValue:t.value.name,"onUpdate:modelValue":n[1]||(n[1]=l=>t.value.name=l),modelModifiers:{trim:!0},label:"Nombre",rules:[d(S)]},null,8,["modelValue","rules"])]),_:1}),e(o,{cols:"12",md:"6"},{default:a(()=>[e(i,{modelValue:t.value.paternal_surname,"onUpdate:modelValue":n[2]||(n[2]=l=>t.value.paternal_surname=l),modelModifiers:{trim:!0},label:"Apellido Paterno",rules:[d(q)(t.value.maternal_surname)]},null,8,["modelValue","rules"])]),_:1}),e(o,{cols:"12",md:"6"},{default:a(()=>[e(i,{modelValue:t.value.maternal_surname,"onUpdate:modelValue":n[3]||(n[3]=l=>t.value.maternal_surname=l),modelModifiers:{trim:!0},label:"Apellido Materno",rules:[d(q)(t.value.paternal_surname)]},null,8,["modelValue","rules"])]),_:1}),e(o,{cols:"12"},{default:a(()=>[e(V,{modelValue:t.value.office_id,"onUpdate:modelValue":n[4]||(n[4]=l=>t.value.office_id=l),items:[{value:null,title:"Todas las oficinas (no seleccionar ninguna)"},...r.offices],label:"Oficina",hint:"Selecciona una oficina, si no seleccionas ninguna se asignará a todas las oficinas","persistent-hint":"","return-object":!1},null,8,["modelValue","items"])]),_:1}),e(o,{cols:"12"},{default:a(()=>[e(U,{rules:[d(S)],modelValue:t.value.role_id,"onUpdate:modelValue":n[5]||(n[5]=l=>t.value.role_id=l),items:r.roles,label:"Rol"},null,8,["rules","modelValue","items"])]),_:1}),e(o,{cols:"12"},{default:a(()=>[e(i,{modelValue:t.value.email,"onUpdate:modelValue":n[6]||(n[6]=l=>t.value.email=l),modelModifiers:{trim:!0},label:"Correo",rules:[d(S),d(W)]},null,8,["modelValue","rules"])]),_:1}),e(o,{cols:"12"},{default:a(()=>[e(i,{modelValue:t.value.password,"onUpdate:modelValue":n[7]||(n[7]=l=>t.value.password=l),modelModifiers:{trim:!0},label:"Contraseña",type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(o,{cols:"12"},{default:a(()=>[e(y,{label:t.value.status?"Activo":"Inactivo",modelValue:t.value.status,"onUpdate:modelValue":n[8]||(n[8]=l=>t.value.status=l),color:"primary",inset:""},null,8,["label","modelValue"])]),_:1})]),_:1})]),_:1}),e(P,null,{default:a(()=>[e(w,{text:"Cancel",onClick:l=>f.value=!1},null,8,["onClick"]),e(M),e(w,{text:"Guardar",color:"primary",type:"submit",loading:p.value},null,8,["loading"])]),_:2},1024)]),_:2},1032,["title"])]),_:2},1032,["onSubmit"])]),_:3})}}}),le=A({__name:"DataTable",setup(r){const u=v([]),c=v([]),p=[{title:"Nombre",sortable:!0,value:"name"},{title:"Apellido Paterno",sortable:!0,value:"paternal_surname"},{title:"Apellido Materno",sortable:!0,value:"maternal_surname"},{title:"Número de Documento",sortable:!0,value:"document_number"},{title:"Correo Electrónico",sortable:!0,value:"email"},{title:"Estado",sortable:!0,value:"status"},{title:"",value:"actions"}],k=[{title:"Activo",value:!0},{title:"Inactivo",value:!1}],_=v(!1),t=v({...F}),b=v({...z}),m=async i=>{_.value=!0,i.value={...i.value,...i},b.value=await X(i.value),_.value=!1};return H(async()=>{await m(t.value),u.value=await h(),c.value=await ee()}),(i,o)=>{const V=s("v-btn"),U=s("v-text-field"),y=s("v-col"),D=s("v-select"),C=s("v-row"),w=s("v-card-item"),M=s("v-chip"),P=s("v-data-table-server"),$=s("v-card"),x=E("permission"),I=E("tooltip");return N(),R($,null,{default:a(()=>{var f;return[e(w,null,{default:a(()=>[e(C,{justify:"space-between"},{default:a(()=>[e(y,{cols:"12",md:"5",class:"d-flex justify-end align-end"},{default:a(()=>[e(B,{onOnSuccess:o[0]||(o[0]=l=>m(t.value)),offices:u.value,roles:c.value},{btn:a(({activator:l})=>[T(e(V,j(l,{color:"primary",icon:"mdi-plus-circle-outline",class:"me-2"}),null,16),[[x,["users.create"]],[I,"Nuevo Registro"]])]),_:1},8,["offices","roles"]),e(U,{modelValue:t.value.search,"onUpdate:modelValue":o[1]||(o[1]=l=>t.value.search=l),label:"Buscar"},null,8,["modelValue"])]),_:1}),e(y,{cols:"12",md:"2"},{default:a(()=>[e(D,{modelValue:t.value.filters.status,"onUpdate:modelValue":[o[2]||(o[2]=l=>t.value.filters.status=l),o[3]||(o[3]=l=>m(t.value))],label:"Estado",items:k,clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(P,{"items-per-page":t.value.itemsPerPage,"onUpdate:itemsPerPage":o[5]||(o[5]=l=>t.value.itemsPerPage=l),headers:p,items:(f=b.value)==null?void 0:f.data,"items-length":b.value.total,search:t.value.search,"multi-sort":"",loading:_.value,"item-value":"id","items-per-page-text":"Número de filas por página:","onUpdate:options":m},{"item.status":a(({item:l})=>[e(M,{color:l.status?"info":"error"},{default:a(()=>[J(K(l.status?"Activo":"Inactivo"),1)]),_:2},1032,["color"])]),"item.actions":a(({item:l})=>[e(B,{"form-state":l,onOnSuccess:o[4]||(o[4]=O=>m(t.value)),offices:u.value,roles:c.value},{btn:a(({activator:O})=>[T(e(V,j(O,{density:"comfortable",icon:"mdi-pencil",class:"text-button",variant:"tonal"}),null,16),[[x,["users.update"]],[I,"Editar Registro"]])]),_:2},1032,["form-state","offices","roles"])]),_:1},8,["items-per-page","items","items-length","search","loading"])]}),_:1})}}}),ne=A({__name:"index",setup(r){return(u,c)=>(N(),R(le))}});export{ne as default};
