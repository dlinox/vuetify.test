import{D as j}from"./data-table.constants-C9jLg9DU.js";import{v as S,d as I,b as _,r as t,o as $,c as C,w as a,y as O,a as e,f as R,u as M,D as T,l as q,m as B,n as N,h as E}from"./index-Dd4keAtq.js";import{r as F}from"./ruleUtils-DvAtGyw3.js";const G=async s=>{var o,c;try{let n=localStorage.getItem("token"),d=await S(n).post("/roles/items",s);for(let i of d.data.data)i.permissions=(o=i.permissions)==null?void 0:o.split(","),i.permissions=(c=i.permissions)==null?void 0:c.map(r=>parseInt(r));return d.data}catch(n){return console.error(n),j}},z=async()=>{try{let s=localStorage.getItem("token");return(await S(s).get("/roles/permissions")).data}catch(s){return console.error(s),[]}},H=async s=>{try{let o=localStorage.getItem("token");return await S(o).post("/roles",s),!0}catch(o){return console.error(o),!1}},J=async s=>{try{let o=localStorage.getItem("token");return await S(o).put(`/roles/${s.id}`,s),!0}catch(o){return console.error(o),!1}},U=I({__name:"Form",props:{formState:{type:Object,default:()=>({})},permissions:{type:Array,default:()=>[]}},emits:["onSuccess"],setup(s,{emit:o}){const c=o,n=_(!1),d=s,i=_(null),r=_({id:null,name:"",permissions:[],...d.formState}),D=async u=>{var p,v;const{valid:l}=await((p=i.value)==null?void 0:p.validate());l&&(n.value=!0,r.value.id?await J(r.value)&&(c("onSuccess"),u.value=!1):await H(r.value)&&((v=i.value)==null||v.reset(),c("onSuccess"),u.value=!1),n.value=!1)};return(u,l)=>{const p=t("v-text-field"),v=t("v-col"),k=t("v-select"),h=t("v-row"),P=t("v-card-item"),g=t("v-btn"),V=t("v-spacer"),b=t("v-card-actions"),y=t("v-card"),m=t("v-form"),w=t("v-dialog");return $(),C(w,{"max-width":"500"},{activator:a(({props:x})=>[O(u.$slots,"btn",{activator:x})]),default:a(({isActive:x})=>[e(m,{onSubmit:R(f=>D(x),["prevent"]),ref_key:"formRef",ref:i},{default:a(()=>[e(y,{title:r.value.id?"Editar":"Crear"},{default:a(()=>[e(P,null,{default:a(()=>[e(h,null,{default:a(()=>[e(v,{cols:"12"},{default:a(()=>[e(p,{modelValue:r.value.name,"onUpdate:modelValue":l[0]||(l[0]=f=>r.value.name=f),label:"Nombre del rol",rules:[M(F)]},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12"},{default:a(()=>[e(k,{modelValue:r.value.permissions,"onUpdate:modelValue":l[1]||(l[1]=f=>r.value.permissions=f),items:s.permissions,label:"Permisos",chips:"",multiple:""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),e(b,null,{default:a(()=>[e(g,{text:"Cancelar",color:"secondary",onClick:f=>x.value=!1},null,8,["onClick"]),e(V),e(g,{text:"Guardar",color:"primary",type:"submit",loading:n.value},null,8,["loading"])]),_:2},1024)]),_:2},1032,["title"])]),_:2},1032,["onSubmit"])]),_:3})}}}),K={class:"d-flex justify-end"},L=I({__name:"DataTable",setup(s){const o=[{title:"Nombre",sortable:!0,value:"name"},{title:"",value:"actions"}],c=_(!1),n=_({page:1,itemsPerPage:10,search:"",filters:{},sortBy:[],groupBy:""}),d=_([]),i=_({...j}),r=async u=>{c.value=!0,u.value={...u.value,...u},i.value=await G(u.value),c.value=!1};return T(async()=>{d.value=await z()}),(u,l)=>{const p=t("v-btn"),v=t("v-text-field"),k=t("v-col"),h=t("v-row"),P=t("v-card-item"),g=t("v-data-table-server"),V=t("v-card"),b=q("permission");return $(),C(V,null,{default:a(()=>{var y;return[e(P,null,{default:a(()=>[e(h,{justify:"space-between"},{default:a(()=>[e(k,{cols:"12",md:"5",class:"d-flex justify-end align-end"},{default:a(()=>[e(U,{onOnSuccess:l[0]||(l[0]=m=>r(n.value)),permissions:d.value},{btn:a(({activator:m})=>[B(e(p,N(m,{color:"primary",icon:"mdi-plus-circle-outline",class:"me-2"}),null,16),[[b,["roles.create"]]])]),_:1},8,["permissions"]),e(v,{modelValue:n.value.search,"onUpdate:modelValue":l[1]||(l[1]=m=>n.value.search=m),label:"Buscar"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(g,{"items-per-page":n.value.itemsPerPage,"onUpdate:itemsPerPage":l[3]||(l[3]=m=>n.value.itemsPerPage=m),headers:o,items:(y=i.value)==null?void 0:y.data,"items-length":i.value.total,search:n.value.search,"multi-sort":"",loading:c.value,"item-value":"id","items-per-page-text":"Número de filas por página:","onUpdate:options":r},{"item.actions":a(({item:m})=>[E("div",K,[e(U,{"form-state":m,onOnSuccess:l[2]||(l[2]=w=>r(n.value)),permissions:d.value},{btn:a(({activator:w})=>[B(e(p,N(w,{density:"comfortable",icon:"mdi-pencil",class:"text-button",variant:"tonal"}),null,16),[[b,["roles.update"]]])]),_:2},1032,["form-state","permissions"])])]),_:1},8,["items-per-page","items","items-length","search","loading"])]}),_:1})}}}),Y=I({__name:"index",setup(s){return(o,c)=>($(),C(L))}});export{Y as default};
