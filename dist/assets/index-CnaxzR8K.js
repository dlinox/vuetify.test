import{D as F}from"./data-table.constants-C9jLg9DU.js";import{v as g,d as C,b as v,r as s,o as O,c as $,w as a,y as G,a as t,f as L,u as c,D as z,l as j,m as B,n as E,g as H,t as J}from"./index-DIP8NwNP.js";import{r as U,d as K,a as T,e as Q}from"./ruleUtils-DvAtGyw3.js";const W=async u=>{try{let r=localStorage.getItem("token");return(await g(r).post("/users/items",u)).data}catch(r){return console.error(r),F}},X=async u=>{try{let r=localStorage.getItem("token");return await g(r).post("/users",u),!0}catch(r){return console.error(r),!1}},Y=async u=>{try{let r=localStorage.getItem("token");return await g(r).put(`/users/${u.id}`,u),!0}catch(r){return console.error(r),!1}},Z=async()=>{try{let u=localStorage.getItem("token");return(await g(u).get("/selects/offices")).data}catch(u){return console.error(u),[]}},h=async()=>{try{let u=localStorage.getItem("token");return(await g(u).get("/selects/roles")).data}catch(u){return console.error(u),[]}},ee={id:null,name:"",paternal_surname:"",maternal_surname:"",document_type:"001",document_number:"",office_id:null,role_id:null,email:"",password:"",status:!0,is_editable:!1},q=C({__name:"Form",props:{formState:{type:Object},offices:{type:Array,default:()=>[]},roles:{type:Array,default:()=>[]}},emits:["onSuccess"],setup(u,{emit:r}){const d=r,k=u,_=v(!1),f=v(null),e=v({...ee,...k.formState}),b=async m=>{var i;const{valid:n}=await f.value.validate();n&&(_.value=!0,e.value.id?await Y(e.value)&&(d("onSuccess"),m.value=!1):await X(e.value)&&((i=f.value)==null||i.reset(),d("onSuccess"),m.value=!1),_.value=!1)};return(m,n)=>{const i=s("v-text-field"),o=s("v-col"),V=s("v-combobox"),D=s("v-select"),y=s("v-switch"),w=s("v-row"),R=s("v-card-item"),I=s("v-btn"),M=s("v-spacer"),P=s("v-card-actions"),A=s("v-card"),x=s("v-form"),S=s("v-dialog");return O(),$(S,{"max-width":"700"},{activator:a(({props:p})=>[G(m.$slots,"btn",{activator:p})]),default:a(({isActive:p})=>[t(x,{ref_key:"formRef",ref:f,onSubmit:L(l=>b(p),["prevent"])},{default:a(()=>[t(A,{title:e.value.id?"Editar":"Crear"},{default:a(()=>[t(R,null,{default:a(()=>[t(w,null,{default:a(()=>[t(o,{cols:"12",md:"4"},{default:a(()=>[t(i,{modelValue:e.value.document_number,"onUpdate:modelValue":n[0]||(n[0]=l=>e.value.document_number=l),modelModifiers:{trim:!0},label:"DNI",rules:[c(U),c(K)],autocomplete:"off"},null,8,["modelValue","rules"])]),_:1}),t(o,{cols:"12",md:"8"},{default:a(()=>[t(i,{modelValue:e.value.name,"onUpdate:modelValue":n[1]||(n[1]=l=>e.value.name=l),modelModifiers:{trim:!0},label:"Nombre",rules:[c(U)],autocomplete:"off"},null,8,["modelValue","rules"])]),_:1}),t(o,{cols:"12",md:"6"},{default:a(()=>[t(i,{modelValue:e.value.paternal_surname,"onUpdate:modelValue":n[2]||(n[2]=l=>e.value.paternal_surname=l),modelModifiers:{trim:!0},label:"Apellido Paterno",rules:[c(T)(e.value.maternal_surname)],autocomplete:"off"},null,8,["modelValue","rules"])]),_:1}),t(o,{cols:"12",md:"6"},{default:a(()=>[t(i,{modelValue:e.value.maternal_surname,"onUpdate:modelValue":n[3]||(n[3]=l=>e.value.maternal_surname=l),modelModifiers:{trim:!0},label:"Apellido Materno",rules:[c(T)(e.value.paternal_surname)],autocomplete:"off"},null,8,["modelValue","rules"])]),_:1}),t(o,{cols:"12"},{default:a(()=>[t(V,{modelValue:e.value.office_id,"onUpdate:modelValue":n[4]||(n[4]=l=>e.value.office_id=l),items:[{value:null,title:"Todas las oficinas (no seleccionar ninguna)"},...u.offices],label:"Oficina",hint:"Si no seleccionas ninguna, podrá acceder a todas las oficinas [USUARIO ADMINISTRADOR]","persistent-hint":"","return-object":!1,autocomplete:"off"},null,8,["modelValue","items"])]),_:1}),t(o,{cols:"12"},{default:a(()=>[t(D,{rules:[c(U)],modelValue:e.value.role_id,"onUpdate:modelValue":n[5]||(n[5]=l=>e.value.role_id=l),items:u.roles,label:"Rol",autocomplete:"off"},null,8,["rules","modelValue","items"])]),_:1}),t(o,{cols:"12"},{default:a(()=>[t(i,{modelValue:e.value.email,"onUpdate:modelValue":n[6]||(n[6]=l=>e.value.email=l),modelModifiers:{trim:!0},label:"Correo",autocomplete:"off",rules:[c(U),c(Q)]},null,8,["modelValue","rules"])]),_:1}),t(o,{cols:"12"},{default:a(()=>[t(i,{modelValue:e.value.password,"onUpdate:modelValue":n[7]||(n[7]=l=>e.value.password=l),modelModifiers:{trim:!0},label:"Contraseña",type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),t(o,{cols:"12"},{default:a(()=>[t(y,{label:e.value.status?"Activo":"Inactivo",modelValue:e.value.status,"onUpdate:modelValue":n[8]||(n[8]=l=>e.value.status=l),color:"primary",inset:""},null,8,["label","modelValue"])]),_:1})]),_:1})]),_:1}),t(P,null,{default:a(()=>[t(I,{text:"Cancelar",onClick:l=>p.value=!1,color:"secondary"},null,8,["onClick"]),t(M),t(I,{text:"Guardar",color:"primary",type:"submit",loading:_.value},null,8,["loading"])]),_:2},1024)]),_:2},1032,["title"])]),_:2},1032,["onSubmit"])]),_:3})}}}),te=C({__name:"DataTable",setup(u){const r=v([]),d=v([]),k=[{title:"Nombre",sortable:!0,value:"name"},{title:"Apellido Paterno",sortable:!0,value:"paternal_surname"},{title:"Apellido Materno",sortable:!0,value:"maternal_surname"},{title:"Número de Documento",sortable:!0,value:"document_number"},{title:"Correo Electrónico",sortable:!0,value:"email"},{title:"Estado",sortable:!0,value:"status"},{title:"Rol",sortable:!0,value:"role_name"},{title:"Oficina",sortable:!0,value:"office_name"},{title:"",value:"actions"}],_=[{title:"Activo",value:!0},{title:"Inactivo",value:!1}],f=v(!1),e=v({page:1,itemsPerPage:10,search:"",filters:{},sortBy:[],groupBy:""}),b=v({...F}),m=async i=>{f.value=!0,e.value={...e.value,...i,filters:{...e.value.filters}},b.value=await W(e.value),f.value=!1};return z(async()=>{r.value=await Z(),d.value=await h()}),(i,o)=>{const V=s("v-btn"),D=s("v-text-field"),y=s("v-col"),w=s("v-select"),R=s("v-row"),I=s("v-card-item"),M=s("v-chip"),P=s("v-data-table-server"),A=s("v-card"),x=j("permission"),S=j("tooltip");return O(),$(A,null,{default:a(()=>{var p;return[t(I,null,{default:a(()=>[t(R,{justify:"space-between"},{default:a(()=>[t(y,{cols:"12",md:"5",class:"d-flex justify-end align-end"},{default:a(()=>[t(q,{onOnSuccess:o[0]||(o[0]=l=>m(e.value)),offices:r.value,roles:d.value},{btn:a(({activator:l})=>[B(t(V,E(l,{color:"primary",icon:"mdi-plus-circle-outline",class:"me-2"}),null,16),[[x,["users.create"]],[S,"Nuevo Registro"]])]),_:1},8,["offices","roles"]),t(D,{modelValue:e.value.search,"onUpdate:modelValue":o[1]||(o[1]=l=>e.value.search=l),label:"Buscar"},null,8,["modelValue"])]),_:1}),t(y,{cols:"12",md:"7",class:"d-flex justify-end align-end"},{default:a(()=>[t(w,{modelValue:e.value.filters.office_id,"onUpdate:modelValue":[o[2]||(o[2]=l=>e.value.filters.office_id=l),o[3]||(o[3]=l=>m(e.value))],label:"Oficina",items:r.value,clearable:"",class:"me-2"},null,8,["modelValue","items"]),t(w,{modelValue:e.value.filters.status,"onUpdate:modelValue":[o[4]||(o[4]=l=>e.value.filters.status=l),o[5]||(o[5]=l=>m(e.value))],label:"Estado",items:_,clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(P,{"items-per-page":e.value.itemsPerPage,"onUpdate:itemsPerPage":o[7]||(o[7]=l=>e.value.itemsPerPage=l),headers:k,items:(p=b.value)==null?void 0:p.data,"items-length":b.value.total,search:e.value.search,"multi-sort":"",loading:f.value,"item-value":"id","items-per-page-text":"Número de filas por página:","onUpdate:options":m},{"item.status":a(({item:l})=>[t(M,{color:l.status?"info":"error"},{default:a(()=>[H(J(l.status?"Activo":"Inactivo"),1)]),_:2},1032,["color"])]),"item.actions":a(({item:l})=>[t(q,{"form-state":l,onOnSuccess:o[6]||(o[6]=N=>m(e.value)),offices:r.value,roles:d.value},{btn:a(({activator:N})=>[B(t(V,E(N,{density:"comfortable",icon:"mdi-pencil",class:"text-button",variant:"tonal"}),null,16),[[x,["users.update"]],[S,"Editar Registro"]])]),_:2},1032,["form-state","offices","roles"])]),_:1},8,["items-per-page","items","items-length","search","loading"])]}),_:1})}}}),se=C({__name:"index",setup(u){return(r,d)=>(O(),$(te))}});export{se as default};
