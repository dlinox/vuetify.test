import{D as q,a as G}from"./data-table.constants-C9jLg9DU.js";import{v as U,d as N,b as _,r as n,o as $,c as j,w as l,y as L,a as e,f as W,u as c,g as F,l as X,m as E,n as R,t as z}from"./index-Dd4keAtq.js";import{r as S,d as H,a as B,e as J}from"./ruleUtils-DvAtGyw3.js";const K=async m=>{try{let u=localStorage.getItem("token");return(await U(u).post("/workers/items",m)).data}catch(u){return console.error(u),q}},Q=async m=>{try{let u=localStorage.getItem("token");return await U(u).post("/workers",m),!0}catch(u){return console.error(u),!1}},Y=async m=>{try{let u=localStorage.getItem("token");return await U(u).put(`/workers/${m.id}`,m),!0}catch(u){return console.error(u),!1}},Z=async()=>{try{let m=localStorage.getItem("token");return(await U(m).get("/selects/offices")).data}catch(m){return console.error(m),[]}},h={id:null,name:"",code:null,type:"001",office_id:null,paternal_surname:"",maternal_surname:"",document_type:"001",document_number:"",birthdate:"",phone_number:"",email:"",gender:"",status:!0},M=N({__name:"Form",props:{formState:{type:Object,default:()=>({})},offices:{type:Array,default:()=>[]}},emits:["onSuccess"],setup(m,{emit:u}){const b=u,D=m,v=_(!1),i=[{title:"Administrativo",value:"001"},{title:"Cas",value:"002"},{title:"Obrero",value:"003"},{title:"Profecional de Obra",value:"004"},{title:"EXTERNO",value:"000"}],p=_(null),t=_({...h,...D.formState}),f=async g=>{var o,d;const{valid:a}=await((o=p.value)==null?void 0:o.validate());a&&(v.value=!0,t.value.id?await Y(t.value)&&(b("onSuccess"),g.value=!1):await Q(t.value)&&((d=p.value)==null||d.reset(),b("onSuccess"),g.value=!1),v.value=!1)};return(g,a)=>{const o=n("v-text-field"),d=n("v-col"),O=n("v-select"),y=n("v-combobox"),w=n("v-switch"),C=n("v-row"),P=n("v-card-item"),k=n("v-btn"),T=n("v-spacer"),A=n("v-card-actions"),x=n("v-card"),I=n("v-form"),r=n("v-dialog");return $(),j(r,{"max-width":"700"},{activator:l(({props:V})=>[L(g.$slots,"btn",{activator:V})]),default:l(({isActive:V})=>[e(I,{onSubmit:W(s=>f(V),["prevent"]),ref_key:"formRef",ref:p},{default:l(()=>[e(x,{title:t.value.id?"Editar":"Crear"},{default:l(()=>[e(P,null,{default:l(()=>[e(C,null,{default:l(()=>[e(d,{cols:"12",md:"6"},{default:l(()=>[e(o,{modelValue:t.value.document_number,"onUpdate:modelValue":a[0]||(a[0]=s=>t.value.document_number=s),label:"DNI",rules:[c(S),c(H)]},null,8,["modelValue","rules"])]),_:1}),e(d,{cols:"12",md:"6"},{default:l(()=>[e(o,{modelValue:t.value.code,"onUpdate:modelValue":a[1]||(a[1]=s=>t.value.code=s),label:"Código Trabajador"},null,8,["modelValue"])]),_:1}),e(d,{cols:"12"},{default:l(()=>[e(o,{modelValue:t.value.name,"onUpdate:modelValue":a[2]||(a[2]=s=>t.value.name=s),label:"Nombre",rules:[c(S)]},null,8,["modelValue","rules"])]),_:1}),e(d,{cols:"12",md:"6"},{default:l(()=>[e(o,{modelValue:t.value.paternal_surname,"onUpdate:modelValue":a[3]||(a[3]=s=>t.value.paternal_surname=s),label:"Apellido Paterno",rules:[c(B)(t.value.maternal_surname)]},null,8,["modelValue","rules"])]),_:1}),e(d,{cols:"12",md:"6"},{default:l(()=>[e(o,{modelValue:t.value.maternal_surname,"onUpdate:modelValue":a[4]||(a[4]=s=>t.value.maternal_surname=s),label:"Apellido Materno",rules:[c(B)(t.value.paternal_surname)]},null,8,["modelValue","rules"])]),_:1}),e(d,{cols:"12",md:"6"},{default:l(()=>[e(o,{modelValue:t.value.email,"onUpdate:modelValue":a[5]||(a[5]=s=>t.value.email=s),label:"Email",rules:[c(S),c(J)]},null,8,["modelValue","rules"])]),_:1}),e(d,{cols:"12",md:"6"},{default:l(()=>[e(O,{modelValue:t.value.type,"onUpdate:modelValue":a[6]||(a[6]=s=>t.value.type=s),items:i,label:"Tipo de Trabajador",rules:[c(S)]},null,8,["modelValue","rules"])]),_:1}),e(d,{cols:"12",md:"6"},{default:l(()=>[e(y,{modelValue:t.value.office_id,"onUpdate:modelValue":a[7]||(a[7]=s=>t.value.office_id=s),items:[{value:null,title:"Todas las oficinas (no seleccionar ninguna)"},...m.offices],label:"Oficina","return-object":!1},null,8,["modelValue","items"])]),_:1}),e(d,{cols:"12"},{default:l(()=>[e(w,{label:t.value.status?"Activo":"Inactivo",modelValue:t.value.status,"onUpdate:modelValue":a[8]||(a[8]=s=>t.value.status=s),color:"blue-darken-4",inset:""},null,8,["label","modelValue"])]),_:1})]),_:1})]),_:1}),e(A,null,{default:l(()=>[e(k,{color:"secondary",onClick:s=>V.value=!1},{default:l(()=>[F(" Cancelar ")]),_:2},1032,["onClick"]),e(T),e(k,{text:"Guardar",color:"primary",type:"submit",loading:v.value},null,8,["loading"])]),_:2},1024)]),_:2},1032,["title"])]),_:2},1032,["onSubmit"])]),_:3})}}}),ee=N({__name:"DataTable",setup(m){const u=[{title:"DNI",value:"document_number",sortable:!0},{title:"Nombre",value:"name",sortable:!0},{title:"Apellido Paterno",sortable:!0,value:"paternal_surname"},{title:"Apellido Materno",sortable:!0,value:"maternal_surname"},{title:"Correo",sortable:!0,value:"email"},{title:"Tipo",sortable:!0,value:"type_name"},{title:"Estado",sortable:!0,value:"status"},{title:"",value:"actions"}],b=[{title:"Activo",value:!0},{title:"Inactivo",value:!1}],D=[{title:"Administrativo",value:"001"},{title:"Cas",value:"002"},{title:"Obrero",value:"003"},{title:"Profecional de Obra",value:"004"}],v=_(!1),i=_({...G}),p=_([]),t=_({...q}),f=async a=>{v.value=!0,i.value={...i.value,...a,filters:{...i.value.filters}},t.value=await K(i.value),v.value=!1};return(async()=>{p.value=await Z()})(),(a,o)=>{const d=n("v-btn"),O=n("v-text-field"),y=n("v-col"),w=n("v-select"),C=n("v-row"),P=n("v-card-item"),k=n("v-chip"),T=n("v-data-table-server"),A=n("v-card"),x=X("permission");return $(),j(A,null,{default:l(()=>{var I;return[e(P,null,{default:l(()=>[e(C,{justify:"space-between"},{default:l(()=>[e(y,{cols:"12",md:"5",class:"d-flex justify-end align-end"},{default:l(()=>[e(M,{onOnSuccess:f,offices:p.value},{btn:l(({activator:r})=>[E(e(d,R(r,{color:"primary",icon:"mdi-plus-circle-outline",class:"me-2"}),null,16),[[x,["workers.create"]]])]),_:1},8,["offices"]),e(O,{modelValue:i.value.search,"onUpdate:modelValue":o[0]||(o[0]=r=>i.value.search=r),label:"Buscar"},null,8,["modelValue"])]),_:1}),e(y,{cols:"12",md:"5",class:"d-flex justify-end align-end"},{default:l(()=>[e(w,{modelValue:i.value.filters.type,"onUpdate:modelValue":[o[1]||(o[1]=r=>i.value.filters.type=r),o[2]||(o[2]=r=>f(i.value))],label:"Tipo",items:D,clearable:"",class:"me-2"},null,8,["modelValue"]),e(w,{modelValue:i.value.filters.status,"onUpdate:modelValue":[o[3]||(o[3]=r=>i.value.filters.status=r),o[4]||(o[4]=r=>f(i.value))],label:"Estado",items:b,clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(T,{"items-per-page":i.value.itemsPerPage,"onUpdate:itemsPerPage":o[5]||(o[5]=r=>i.value.itemsPerPage=r),headers:u,items:(I=t.value)==null?void 0:I.data,"items-length":t.value.total,search:i.value.search,"multi-sort":"",loading:v.value,"item-value":"id","items-per-page-text":"Número de filas por página:","onUpdate:options":f},{"item.status":l(({item:r})=>[e(k,{color:r.status?"info":"error"},{default:l(()=>[F(z(r.status?"Activo":"Inactivo"),1)]),_:2},1032,["color"])]),"item.actions":l(({item:r})=>[e(M,{"form-state":r,onOnSuccess:f,offices:p.value},{btn:l(({activator:V})=>[E(e(d,R(V,{density:"comfortable",icon:"mdi-pencil",class:"text-button",variant:"tonal"}),null,16),[[x,["workers.update"]]])]),_:2},1032,["form-state","offices"])]),_:1},8,["items-per-page","items","items-length","search","loading"])]}),_:1})}}}),oe=N({__name:"index",setup(m){return(u,b)=>($(),j(ee))}});export{oe as default};
