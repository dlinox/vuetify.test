import{a as B,D as O}from"./data-table.constants-B0R7xaSt.js";import{p as S,d as P,b as v,r as t,o as D,c as $,w as n,A as R,a as e,f as T,u as M,z as q,i as z,j,m as N,h as E}from"./index-Bc2AUl2l.js";import{r as F}from"./ruleUtils-B_kFGKyT.js";const G=async l=>{var o,c;try{let s=localStorage.getItem("token"),d=await S(s).post("/roles/items",l);for(let i of d.data.data)i.permissions=(o=i.permissions)==null?void 0:o.split(","),i.permissions=(c=i.permissions)==null?void 0:c.map(a=>parseInt(a));return d.data}catch(s){return console.error(s),B}},A=async()=>{try{let l=localStorage.getItem("token");return(await S(l).get("/roles/permissions")).data}catch(l){return console.error(l),[]}},H=async l=>{try{let o=localStorage.getItem("token");return await S(o).post("/roles",l),!0}catch(o){return console.error(o),!1}},J=async l=>{try{let o=localStorage.getItem("token");return await S(o).put(`/roles/${l.id}`,l),!0}catch(o){return console.error(o),!1}},U=P({__name:"Form",props:{formState:{type:Object,default:()=>({})},permissions:{type:Array,default:()=>[]}},emits:["onSuccess"],setup(l,{emit:o}){const c=o,s=v(!1),d=l,i=v(null),a=v({id:null,name:"",permissions:[],...d.formState}),C=async u=>{var p;const{valid:r}=await((p=i.value)==null?void 0:p.validate());r&&(s.value=!0,a.value.id?await J(a.value)&&(a.value={id:null,name:"",permissions:[]},c("onSuccess"),u.value=!1):await H(a.value)&&(a.value={id:null,name:"",permissions:[]},c("onSuccess"),u.value=!1),s.value=!1)};return(u,r)=>{const p=t("v-text-field"),f=t("v-col"),k=t("v-select"),h=t("v-row"),V=t("v-card-item"),g=t("v-btn"),I=t("v-spacer"),b=t("v-card-actions"),y=t("v-card"),m=t("v-form"),w=t("v-dialog");return D(),$(w,{"max-width":"500"},{activator:n(({props:x})=>[R(u.$slots,"btn",{activator:x})]),default:n(({isActive:x})=>[e(m,{onSubmit:T(_=>C(x),["prevent"]),ref_key:"formRef",ref:i},{default:n(()=>[e(y,{title:a.value.id?"Editar":"Crear"},{default:n(()=>[e(V,null,{default:n(()=>[e(h,null,{default:n(()=>[e(f,{cols:"12"},{default:n(()=>[e(p,{modelValue:a.value.name,"onUpdate:modelValue":r[0]||(r[0]=_=>a.value.name=_),label:"Nombre del rol",rules:[M(F)]},null,8,["modelValue","rules"])]),_:1}),e(f,{cols:"12"},{default:n(()=>[e(k,{modelValue:a.value.permissions,"onUpdate:modelValue":r[1]||(r[1]=_=>a.value.permissions=_),items:l.permissions,label:"Permisos",chips:"",multiple:""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),e(b,null,{default:n(()=>[e(g,{text:"Cancel",onClick:_=>x.value=!1},null,8,["onClick"]),e(I),e(g,{text:"Guardar",color:"primary",type:"submit",loading:s.value},null,8,["loading"])]),_:2},1024)]),_:2},1032,["title"])]),_:2},1032,["onSubmit"])]),_:3})}}}),K={class:"d-flex justify-end"},L=P({__name:"DataTable",setup(l){const o=[{title:"Nombre",sortable:!0,value:"name"},{title:"",value:"actions"}],c=v(!1),s=v({...O}),d=v([]),i=v({...B}),a=async u=>{c.value=!0,u.value={...u.value,...u},i.value=await G(u.value),c.value=!1};return q(async()=>{await a(s.value),d.value=await A()}),(u,r)=>{const p=t("v-btn"),f=t("v-text-field"),k=t("v-col"),h=t("v-row"),V=t("v-card-item"),g=t("v-data-table-server"),I=t("v-card"),b=z("permission");return D(),$(I,null,{default:n(()=>{var y;return[e(V,null,{default:n(()=>[e(h,{justify:"space-between"},{default:n(()=>[e(k,{cols:"12",md:"5",class:"d-flex justify-end align-end"},{default:n(()=>[e(U,{onOnSuccess:r[0]||(r[0]=m=>a(s.value)),permissions:d.value},{btn:n(({activator:m})=>[j(e(p,N(m,{color:"primary",icon:"mdi-plus-circle-outline",class:"me-2"}),null,16),[[b,["roles.create"]]])]),_:1},8,["permissions"]),e(f,{modelValue:s.value.search,"onUpdate:modelValue":r[1]||(r[1]=m=>s.value.search=m),label:"Buscar"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(g,{"items-per-page":s.value.itemsPerPage,"onUpdate:itemsPerPage":r[3]||(r[3]=m=>s.value.itemsPerPage=m),headers:o,items:(y=i.value)==null?void 0:y.data,"items-length":i.value.total,search:s.value.search,"multi-sort":"",loading:c.value,"item-value":"id","items-per-page-text":"Número de filas por página:","onUpdate:options":a},{"item.actions":n(({item:m})=>[E("div",K,[e(U,{"form-state":m,onOnSuccess:r[2]||(r[2]=w=>a(s.value)),permissions:d.value},{btn:n(({activator:w})=>[j(e(p,N(w,{density:"comfortable",icon:"mdi-pencil",class:"text-button",variant:"tonal"}),null,16),[[b,["roles.update"]]])]),_:2},1032,["form-state","permissions"])])]),_:1},8,["items-per-page","items","items-length","search","loading"])]}),_:1})}}}),Y=P({__name:"index",setup(l){return(o,c)=>(D(),$(L))}});export{Y as default};
