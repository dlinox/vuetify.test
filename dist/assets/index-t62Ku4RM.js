import{D as h}from"./data-table.constants-C9jLg9DU.js";import{C as z,q as S,d as A,b as v,r as s,o as N,c as R,w as a,z as F,a as e,f as G,u as d,B as L,k as O,l as E,m as j,g as H,t as J}from"./index-Blmc5BWJ.js";import{r as I,d as K,a as T,e as Q}from"./ruleUtils-B_kFGKyT.js";const W=async n=>{try{let u=localStorage.getItem("token");return(await z.post("http://localhost:8000/api/users/items",n,{headers:{Authorization:`Bearer ${u}`}})).data}catch(u){return console.error(u),h}},X=async n=>{try{let u=localStorage.getItem("token");return await S(u).post("/users",n),!0}catch(u){return console.error(u),!1}},Y=async n=>{try{let u=localStorage.getItem("token");return await S(u).put(`/users/${n.id}`,n),!0}catch(u){return console.error(u),!1}},Z=async()=>{try{let n=localStorage.getItem("token");return(await S(n).get("/selects/offices")).data}catch(n){return console.error(n),[]}},ee=async()=>{try{let n=localStorage.getItem("token");return(await S(n).get("/selects/roles")).data}catch(n){return console.error(n),[]}},te={id:null,name:"",paternal_surname:"",maternal_surname:"",document_type:"001",document_number:"",office_id:null,role_id:null,email:"",password:"",status:!0,is_editable:!1},q=A({__name:"Form",props:{formState:{type:Object},offices:{type:Array,default:()=>[]},roles:{type:Array,default:()=>[]}},emits:["onSuccess"],setup(n,{emit:u}){const c=u,k=n,_=v(!1),p=v(null),t=v({...te,...k.formState}),b=async m=>{const{valid:r}=await p.value.validate();r&&(_.value=!0,t.value.id?await Y(t.value)&&(c("onSuccess"),m.value=!1):await X(t.value)&&(c("onSuccess"),m.value=!1),_.value=!1)};return(m,r)=>{const i=s("v-text-field"),o=s("v-col"),g=s("v-combobox"),U=s("v-select"),V=s("v-switch"),C=s("v-row"),P=s("v-card-item"),y=s("v-btn"),D=s("v-spacer"),M=s("v-card-actions"),$=s("v-card"),w=s("v-form"),x=s("v-dialog");return N(),R(x,{"max-width":"700"},{activator:a(({props:f})=>[F(m.$slots,"btn",{activator:f})]),default:a(({isActive:f})=>[e(w,{ref_key:"formRef",ref:p,onSubmit:G(l=>b(f),["prevent"])},{default:a(()=>[e($,{title:t.value.id?"Editar":"Crear"},{default:a(()=>[e(P,null,{default:a(()=>[e(C,null,{default:a(()=>[e(o,{cols:"12",md:"4"},{default:a(()=>[e(i,{modelValue:t.value.document_number,"onUpdate:modelValue":r[0]||(r[0]=l=>t.value.document_number=l),modelModifiers:{trim:!0},label:"DNI",rules:[d(I),d(K)]},null,8,["modelValue","rules"])]),_:1}),e(o,{cols:"12",md:"8"},{default:a(()=>[e(i,{modelValue:t.value.name,"onUpdate:modelValue":r[1]||(r[1]=l=>t.value.name=l),modelModifiers:{trim:!0},label:"Nombre",rules:[d(I)]},null,8,["modelValue","rules"])]),_:1}),e(o,{cols:"12",md:"6"},{default:a(()=>[e(i,{modelValue:t.value.paternal_surname,"onUpdate:modelValue":r[2]||(r[2]=l=>t.value.paternal_surname=l),modelModifiers:{trim:!0},label:"Apellido Paterno",rules:[d(T)(t.value.maternal_surname)]},null,8,["modelValue","rules"])]),_:1}),e(o,{cols:"12",md:"6"},{default:a(()=>[e(i,{modelValue:t.value.maternal_surname,"onUpdate:modelValue":r[3]||(r[3]=l=>t.value.maternal_surname=l),modelModifiers:{trim:!0},label:"Apellido Materno",rules:[d(T)(t.value.paternal_surname)]},null,8,["modelValue","rules"])]),_:1}),e(o,{cols:"12"},{default:a(()=>[e(g,{modelValue:t.value.office_id,"onUpdate:modelValue":r[4]||(r[4]=l=>t.value.office_id=l),items:[{value:null,title:"Todas las oficinas (no seleccionar ninguna)"},...n.offices],label:"Oficina",hint:"Selecciona una oficina, si no seleccionas ninguna se asignará a todas las oficinas","persistent-hint":"","return-object":!1},null,8,["modelValue","items"])]),_:1}),e(o,{cols:"12"},{default:a(()=>[e(U,{rules:[d(I)],modelValue:t.value.role_id,"onUpdate:modelValue":r[5]||(r[5]=l=>t.value.role_id=l),items:n.roles,label:"Rol"},null,8,["rules","modelValue","items"])]),_:1}),e(o,{cols:"12"},{default:a(()=>[e(i,{modelValue:t.value.email,"onUpdate:modelValue":r[6]||(r[6]=l=>t.value.email=l),modelModifiers:{trim:!0},label:"Correo",rules:[d(I),d(Q)]},null,8,["modelValue","rules"])]),_:1}),e(o,{cols:"12"},{default:a(()=>[e(i,{modelValue:t.value.password,"onUpdate:modelValue":r[7]||(r[7]=l=>t.value.password=l),modelModifiers:{trim:!0},label:"Contraseña",type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(o,{cols:"12"},{default:a(()=>[e(V,{label:t.value.status?"Activo":"Inactivo",modelValue:t.value.status,"onUpdate:modelValue":r[8]||(r[8]=l=>t.value.status=l),color:"primary",inset:""},null,8,["label","modelValue"])]),_:1})]),_:1})]),_:1}),e(M,null,{default:a(()=>[e(y,{text:"Cancelar",onClick:l=>f.value=!1,color:"secondary"},null,8,["onClick"]),e(D),e(y,{text:"Guardar",color:"primary",type:"submit",loading:_.value},null,8,["loading"])]),_:2},1024)]),_:2},1032,["title"])]),_:2},1032,["onSubmit"])]),_:3})}}}),le=A({__name:"DataTable",setup(n){const u=v([]),c=v([]),k=[{title:"Nombre",sortable:!0,value:"name"},{title:"Apellido Paterno",sortable:!0,value:"paternal_surname"},{title:"Apellido Materno",sortable:!0,value:"maternal_surname"},{title:"Número de Documento",sortable:!0,value:"document_number"},{title:"Correo Electrónico",sortable:!0,value:"email"},{title:"Estado",sortable:!0,value:"status"},{title:"",value:"actions"}],_=[{title:"Activo",value:!0},{title:"Inactivo",value:!1}],p=v(!1),t=v({page:1,itemsPerPage:10,search:"",filters:{},sortBy:[],groupBy:""}),b=v({...h}),m=async i=>{p.value=!0,i.value={...i.value,...i},b.value=await W(i.value),p.value=!1};return L(async()=>{await m(t.value),u.value=await Z(),c.value=await ee()}),(i,o)=>{const g=s("v-btn"),U=s("v-text-field"),V=s("v-col"),C=s("v-select"),P=s("v-row"),y=s("v-card-item"),D=s("v-chip"),M=s("v-data-table-server"),$=s("v-card"),w=O("permission"),x=O("tooltip");return N(),R($,null,{default:a(()=>{var f;return[e(y,null,{default:a(()=>[e(P,{justify:"space-between"},{default:a(()=>[e(V,{cols:"12",md:"5",class:"d-flex justify-end align-end"},{default:a(()=>[e(q,{onOnSuccess:o[0]||(o[0]=l=>m(t.value)),offices:u.value,roles:c.value},{btn:a(({activator:l})=>[E(e(g,j(l,{color:"primary",icon:"mdi-plus-circle-outline",class:"me-2"}),null,16),[[w,["users.create"]],[x,"Nuevo Registro"]])]),_:1},8,["offices","roles"]),e(U,{modelValue:t.value.search,"onUpdate:modelValue":o[1]||(o[1]=l=>t.value.search=l),label:"Buscar"},null,8,["modelValue"])]),_:1}),e(V,{cols:"12",md:"2"},{default:a(()=>[e(C,{modelValue:t.value.filters.status,"onUpdate:modelValue":[o[2]||(o[2]=l=>t.value.filters.status=l),o[3]||(o[3]=l=>m(t.value))],label:"Estado",items:_,clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(M,{"items-per-page":t.value.itemsPerPage,"onUpdate:itemsPerPage":o[5]||(o[5]=l=>t.value.itemsPerPage=l),headers:k,items:(f=b.value)==null?void 0:f.data,"items-length":b.value.total,search:t.value.search,"multi-sort":"",loading:p.value,"item-value":"id","items-per-page-text":"Número de filas por página:"},{"item.status":a(({item:l})=>[e(D,{color:l.status?"info":"error"},{default:a(()=>[H(J(l.status?"Activo":"Inactivo"),1)]),_:2},1032,["color"])]),"item.actions":a(({item:l})=>[e(q,{"form-state":l,onOnSuccess:o[4]||(o[4]=B=>m(t.value)),offices:u.value,roles:c.value},{btn:a(({activator:B})=>[E(e(g,j(B,{density:"comfortable",icon:"mdi-pencil",class:"text-button",variant:"tonal"}),null,16),[[w,["users.update"]],[x,"Editar Registro"]])]),_:2},1032,["form-state","offices","roles"])]),_:1},8,["items-per-page","items","items-length","search","loading"])]}),_:1})}}}),re=A({__name:"index",setup(n){return(u,c)=>(N(),R(le))}});export{re as default};
